<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.idcq.appserver.dto.goods.TopGoodsDto" >
  <resultMap id="BaseResultMap" type="com.idcq.appserver.dto.goods.TopGoodsDto" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Mar 10 15:27:44 CST 2015.
    -->
    <id column="hot_goods_id" property="hotGoodsId" jdbcType="INTEGER" />
    <result column="top_type" property="topType" jdbcType="VARCHAR" />
    <result column="goods_id" property="goodsId" jdbcType="INTEGER" />
    <result column="goods_index" property="goodsIndex" jdbcType="INTEGER" />
    <result column="sold_number" property="soldNumber" jdbcType="INTEGER" />
    <result column="zan_number" property="zanNumber" jdbcType="INTEGER" />
    <result column="city_id" property="cityId" jdbcType="VARCHAR" />
    <result column="goods_type" property="goodsType" jdbcType="INTEGER" />
    <result column="shop_id" property="shopId" jdbcType="INTEGER" />
    <result column="goods_name" property="goodsName" jdbcType="VARCHAR" />
    <result column="goodsLogo1" property="goodsLogo1" jdbcType="VARCHAR" />
    <result column="goodsLogo2" property="goodsLogo2" jdbcType="VARCHAR" />
    <result column="shop_name" property="shopName" jdbcType="VARCHAR" />
    <result column="longitude" property="longitude" jdbcType="VARCHAR" />
    <result column="latitude" property="latitude" jdbcType="VARCHAR" />
    <result column="goods_url" property="goodsUrl" jdbcType="VARCHAR" />
    <result column="goods_no" property="goodsNo" jdbcType="VARCHAR" />
  </resultMap>
  <sql id="Base_Column_List" >
    t1.hot_goods_id as hot_goods_id, 
    t1.top_type as top_type, 
    t1.goods_id as goods_id, 
    t1.goods_index as goods_index, 
    t1.sold_number as sold_number, 
    t1.zan_number as zan_number, 
    t1.city_id as city_id,
    
	t2.goods_type as goods_type,
	t2.goods_name as goods_name,
	t2.goods_desc as goods_desc,
	t2.goods_no as goods_no,
	
<!-- 	t2.goods_url as goods_url, -->
<!-- 	t2.big_logo as goodsLogo1, -->
<!-- 	t2.small_logo as goodsLogo2, -->
	
	t3.shop_id as shop_id,
	t3.shop_name as shop_name,
	t3.longitude as longitude,
	t3.latitude as latitude,
	t4.file_url as goodsLogo1,
    t5.file_url as goodsLogo2
  </sql>
  
   <select id="getTopGoodsList" parameterType="java.util.Map"  resultMap="BaseResultMap">
    	select 
    	<include refid="Base_Column_List"/> 
    	from 1dcq_top_goods t1 
    	inner join 1dcq_goods t2 on t1.goods_id = t2.goods_id  and t2.goods_status = 1
    	inner join 1dcq_shop t3 on t2.shop_id = t3.shop_id
    	<if test="topGoods.cityId != null" >
    		and t1.city_id = #{topGoods.cityId}
    	</if>
    	<if test="topGoods.topType != null" >
    		and t1.top_type = #{topGoods.topType}
    	</if>
    	left join 1dcq_attachment t4 on t2.goods_logo1 = t4.attachement_id
    	left join 1dcq_attachment t5 on t2.goods_logo2 = t5.attachement_id
    	
    	order by t1.goods_index limit #{n},#{m}
    </select>
    
   <select id="getTopGoodsListCount" parameterType="java.util.Map"  resultType="int">
    	select count(1)
    	from 1dcq_top_goods t1 
    	inner join 1dcq_goods t2 on t1.goods_id = t2.goods_id  
    	inner join 1dcq_shop t3 on t2.shop_id = t3.shop_id
    	<if test="topGoods.cityId != null and topGoods.cityId != ''" >
    		and t1.city_id = #{topGoods.cityId}
    	</if>
    	<if test="topGoods.topType != null and topGoods.topType != ''" >
    		and t1.top_type = #{topGoods.topType}
    	</if>
    </select>
  
</mapper>