<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.idcq.appserver.dto.shop.BookRuleDto" >
  <resultMap id="BaseResultMap" type="com.idcq.appserver.dto.shop.BookRuleDto" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon May 04 16:53:08 CST 2015.
    -->
    <id column="book_rule_id" property="bookRuleId" jdbcType="INTEGER" />
    <result column="shop_id" property="shopId" jdbcType="INTEGER" />
    <result column="rule_name" property="ruleName" jdbcType="VARCHAR" />
    <result column="rule_order" property="ruleOrder" jdbcType="INTEGER" />
    <result column="available_time_from" property="availableTimeFrom" jdbcType="TIME" />
    <result column="available_time_to" property="availableTimeTo" jdbcType="TIME" />
    <result column="unavailable_datetime_from" property="unavailableDatetimeFrom" jdbcType="VARCHAR" />
    <result column="unavailable_datetime_to" property="unavailableDatetimeTo" jdbcType="VARCHAR" />
    <result column="book_dates" property="bookDates" jdbcType="TINYINT" />
    <result column="book_hours" property="bookHours" jdbcType="DECIMAL" />
    <result column="book_overdue_dates" property="bookOverdueDates" jdbcType="DECIMAL" />
    <result column="book_overdue_hours" property="bookOverdueHours" jdbcType="DECIMAL" />
    <result column="book_type" property="bookType" jdbcType="VARCHAR" />
    <result column="book_people_limit_from" property="bookPeopleLimitFrom" jdbcType="INTEGER" />
    <result column="book_people_limit_to" property="bookPeopleLimitTo" jdbcType="INTEGER" />
    <result column="group_id" property="groupId" jdbcType="INTEGER" />
    <result column="book_money" property="bookMoney" jdbcType="DECIMAL" />
    <result column="total_money_flag" property="totalMoneyFlag" jdbcType="TINYINT" />
    <result column="book_number" property="bookNumber" jdbcType="INTEGER" />
    <result column="least_book_price" property="leastBookPrice" jdbcType="INTEGER" />
    <result column="create_time" property="createTime" jdbcType="TIMESTAMP" />
    <result column="is_book" property="isBook" jdbcType="TINYINT" />
    <result column="column_id" property="columnId" jdbcType="TINYINT" />
    <!-- 
    <result column="pay_type" property="payType" jdbcType="TINYINT" />
     -->
  </resultMap>
  <resultMap id="ResultMapWithBLOBs" type="com.idcq.appserver.dto.shop.BookRuleDto" extends="BaseResultMap" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon May 04 16:53:08 CST 2015.
    -->
    <result column="remark" property="remark" jdbcType="LONGVARCHAR" />
  </resultMap>
  
 
  <sql id="Base_Column_List" >
    book_rule_id, shop_id, rule_name, rule_order, available_time_from, available_time_to, 
    unavailable_datetime_from, unavailable_datetime_to, book_dates, book_hours, book_overdue_dates, 
    book_overdue_hours, book_type, book_people_limit_from, book_people_limit_to, group_id, 
    book_money, total_money_flag, book_number, least_book_price, create_time, is_book, 
    column_id
  </sql>
  <sql id="Blob_Column_List" >
    remark
  </sql>
  
 
  <select id="getBookRuleById" resultMap="ResultMapWithBLOBs" parameterType="java.lang.Long" >
    select 
    <include refid="Base_Column_List" />
    ,
    <include refid="Blob_Column_List" />
    from 1dcq_book_rule
    where book_rule_id = #{bookRuleId}
  </select>
  
<!-- 获取通用预定设置费用接口 -->
  <select id="getShopBooktFeeSetting" resultType="java.util.Map" parameterType="java.util.Map" >
		SELECT
			br.goods_category_id as goodsCategoryId,
			br.book_money as bookMoney,
			cast(br.total_money_flag AS signed) as totalMoneyFlag,
		    br.least_book_price as leastBookPrice,
		    br.remark as remark,
			gc.category_name as goodsCategoryName, 
		    br.payment_type as paymentType
		FROM
			1dcq_book_rule br
		LEFT JOIN
			1dcq_goods_category gc
		ON
			br.goods_category_id = gc.goods_category_id
		where
			br.shop_id = #{shopId}
		and
			br.is_book = 1
		LIMIT #{n},#{m}
  </select>
  <select id="getShopBooktFeeSettingCount" resultType="java.lang.Integer" parameterType="java.lang.Long" >
		SELECT
			count(1)
		FROM
			1dcq_book_rule br
		LEFT JOIN
			1dcq_goods_category gc
		ON
			br.goods_category_id = gc.goods_category_id
		where
			br.shop_id = #{shopId}
		and
			br.is_book = 1
  </select>
  
   <select id="getShopBookRule" resultType="java.util.Map" parameterType="java.util.Map" >
		SELECT
		  book_rule_id,shop_id,rule_name,book_type,group_id,book_money,book_number,available_time_from availableTimeFrom,available_time_to availableTimeTo,
			unavailable_datetime_from unavailableDatetimeFrom,unavailable_datetime_to unavailableDatetimeTo,book_dates bookDates,book_hours bookHours
		FROM 1dcq_book_rule
		WHERE 1 =1 
		<if test="shopId !=null">
			and	shop_id = #{shopId}
		</if>
  </select>
  
</mapper>