<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.idcq.appserver.dto.shopcart.ShopCartItemDto" >
  <resultMap id="BaseResultMap" type="com.idcq.appserver.dto.shopcart.ShopCartItemDto" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Mar 13 13:35:59 CST 2015.
    -->
    <id column="item_id" property="itemId" jdbcType="INTEGER" />
    <result column="user_id" property="userId" jdbcType="BIGINT" />
    <result column="goods_id" property="goodsId" jdbcType="BIGINT" />
    <result column="goods_number" property="goodsNumber" jdbcType="DOUBLE" />
    <result column="goods_index" property="goodsIndex" jdbcType="INTEGER" />
    <result column="shop_id" jdbcType="BIGINT" property="shopId" />
    <!-- dto冗余商品信息 -->
    <result column="goods_server_mode" jdbcType="INTEGER" property="goodsServerMode" />
    <result column="goods_type" jdbcType="INTEGER" property="goodsType" />
    <result column="sequence" jdbcType="INTEGER" property="sequence" />
    <result column="goods_name" jdbcType="VARCHAR" property="goodsName" />
    <result column="goods_desc" jdbcType="VARCHAR" property="goodsDesc" />
    <result column="standard_price" jdbcType="DECIMAL" property="standardPrice" />
    <result column="discount_price" jdbcType="DECIMAL" property="discountPrice" />
    <result column="vip_price" jdbcType="DECIMAL" property="vipPrice" />
    <result column="final_price" jdbcType="DECIMAL" property="finalPrice" />
    <result column="unit" jdbcType="VARCHAR" property="unit" />
    <result column="lowest_unit" jdbcType="INTEGER" property="lowestUnit" />
<!--     <result column="big_logo" jdbcType="VARCHAR" property="bigLogo" /> -->
    <result column="goods_logo1" property="goodsLogo1" jdbcType="VARCHAR" />
    <result column="goods_logo2" property="goodsLogo2" jdbcType="VARCHAR" />
<!--     <result column="small_logo" jdbcType="VARCHAR" property="smallLogo" /> -->
    <result column="goods_status" jdbcType="INTEGER" property="goodsStatus" />
    <result column="taste" jdbcType="VARCHAR" property="taste" />
    <result column="spiciness" jdbcType="VARCHAR" property="spiciness" />
<!--     <result column="label" jdbcType="VARCHAR" property="label" /> -->
    <result column="takeout" jdbcType="INTEGER" property="takeout" />
    <result column="zan_number" jdbcType="INTEGER" property="zanNumber" />
    <result column="sold_number" jdbcType="INTEGER" property="soldNumber" />
    <result column="shop_name" jdbcType="VARCHAR" property="shopName" />
  </resultMap>
  <sql id="Base_Column_List" >
    t1.item_id as item_id, t1.user_id as user_id, t1.goods_id as goods_id, 
    t1.goods_number as goods_number, t1.goods_index as goods_index
  </sql>
  <sql id="Goods_Column_List" >
	t2.goods_server_mode as goods_server_mode,t2.goods_type as goods_type,t2.shop_id as shop_id,
	t6.shop_name as shopName,
	t2.sequence as sequence,t2.goods_name as goods_name,t2.goods_desc as goods_desc,
	t2.standard_price as standard_price,t2.discount_price as discount_price,
	t2.vip_price as vip_price,t2.final_price as final_price,
	t2.lowest_unit as lowest_unit,t4.file_url as goodsLogo1,
    t5.file_url as goodsLogo2,
	t2.goods_status as goods_status,t2.taste as taste,t2.spiciness as spiciness,
	t2.takeout as takeout,t2.zan_number as zan_number,t2.sold_number as sold_number,
	t3.unit_name as unit
  </sql>
<!--   查询购物车信息 -->
  <select id="getItemListByUserId" resultMap="BaseResultMap" parameterType="com.idcq.appserver.dto.shopcart.ShopCartItemDto" >
    select 
    <include refid="Base_Column_List" />
    ,
    <include refid="Goods_Column_List" />
    from 
    	1dcq_shopping_cart_item t1 
    inner join 
    	1dcq_shop t6
    on 
    	t6.shop_id=t1.shop_id
    inner join
    	 1dcq_goods t2 
    on 
    	t1.goods_id = t2.goods_id and t1.user_id = #{userId,jdbcType=INTEGER} 
    inner join
    	1dcq_goods_unit t3 
    on 
    	t2.unit_id = t3.unit_id
    inner join
    	1dcq_attachment t4 
    on 
    	t2.goods_logo1 = t4.attachement_id
    inner join 
    	1dcq_attachment t5 
    on 
    	t2.goods_logo2 = t5.attachement_id
    <if test="shopColumnId!=null">
    	where t6.column_id = #{shopColumnId,jdbcType=INTEGER} 
    </if>
  </select>
  
  <select id="getItemListCountByUserId" resultType="int" parameterType="com.idcq.appserver.dto.shopcart.ShopCartItemDto" >
    select 
    count(*)
    from 1dcq_shopping_cart_item t1 
    inner join 1dcq_shop t6
    on t6.shop_id=t1.shop_id
    inner join 1dcq_goods t2 
    on t1.goods_id = t2.goods_id and t1.user_id = #{userId,jdbcType=INTEGER} 
    inner join 1dcq_goods_unit t3 on t2.unit_id = t3.unit_id
    inner join 1dcq_attachment t4 on t2.goods_logo1 = t4.attachement_id
    inner join 1dcq_attachment t5 on t2.goods_logo2 = t5.attachement_id
    <if test="shopColumnId!=null">
    	where t6.column_id = #{shopColumnId,jdbcType=INTEGER} 
    </if>
  </select>
  
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Long" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Mar 13 13:35:59 CST 2015.
    -->
    delete from 1dcq_shopping_cart_item
    where item_id = #{itemId,jdbcType=INTEGER}
  </delete>
  <delete id="delCartItemsByUserId" parameterType="int" >
    delete from 1dcq_shopping_cart_item where user_id = #{userId}
  </delete>
  <insert id="saveCartItem" parameterType="com.idcq.appserver.dto.shopcart.ShopCartItemDto" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Mar 13 13:35:59 CST 2015.
    -->
    insert into 1dcq_shopping_cart_item
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="shopId != null" >
        shop_id,
      </if>
      <if test="userId != null" >
        user_id,
      </if>
      <if test="goodsId != null" >
        goods_id,
      </if>
      <if test="goodsNumber != null" >
        goods_number,
      </if>
      <if test="goodsIndex != null" >
        goods_index,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="shopId != null" >
        #{shopId,jdbcType=INTEGER},
      </if>
      <if test="userId != null" >
        #{userId,jdbcType=INTEGER},
      </if>
      <if test="goodsId != null" >
        #{goodsId,jdbcType=INTEGER},
      </if>
      <if test="goodsNumber != null" >
        #{goodsNumber,jdbcType=DOUBLE},
      </if>
      <if test="goodsIndex != null" >
        #{goodsIndex,jdbcType=INTEGER},
      </if>
    </trim>
  </insert>
  <update id="updateCartItem" parameterType="com.idcq.appserver.dto.shopcart.ShopCartItemDto" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Mar 13 13:35:59 CST 2015.
    -->
    update 1dcq_shopping_cart_item
    <set >
      <if test="itemId != null" >
        item_id = #{itemId,jdbcType=INTEGER},
      </if>
      <if test="userId != null" >
        user_id = #{userId,jdbcType=INTEGER},
      </if>
      <if test="goodsId != null" >
        goods_id = #{goodsId,jdbcType=INTEGER},
      </if>
      <if test="goodsNumber != null" >
        goods_number = #{goodsNumber,jdbcType=DOUBLE},
      </if>
      <if test="goodsIndex != null" >
        goods_index = #{goodsIndex,jdbcType=INTEGER},
      </if>
    </set>
    where user_id = #{userId} and goods_id = #{goodsId}
  </update>
</mapper>