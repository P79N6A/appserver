<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.idcq.appserver.dto.temporyOperate.TemporyOperateDto" >
  <resultMap id="TemporyOperateResultMap" type="com.idcq.appserver.dto.temporyOperate.TemporyOperateDto" >
    <result column="id" property="id" jdbcType="BIGINT" />
    <result column="type" property="type" jdbcType="VARCHAR" />
    <result column="operate_type" jdbcType="VARCHAR" property="operateType" />
  </resultMap>
	
  <select id="getTemporyOperateListByType" parameterType="java.util.Map" resultMap="TemporyOperateResultMap">
  	select * from 1dcq_tempory_index_record
  	where 	type=#{type} limit 0,#{pageSize}
  </select>	  
  
  
  
  
  <delete id="deleteByIds" parameterType="java.util.List">
  	 delete from 1dcq_tempory_index_record
  	 where id in
  	 <foreach collection="list" item="item" open="(" separator="," close=")">
  	 	 #{item}
  	 </foreach>
  </delete>
  
  <insert id="saveTemporyOperate" parameterType="com.idcq.appserver.dto.temporyOperate.TemporyOperateDto" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Mar 13 13:35:59 CST 2015.
    -->
    insert into 1dcq_tempory_index_record
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="id!= null" >
        id,
      </if>
      <if test="type!= null" >
        type,
      </if>
      <if test="operateType!= null" >
        operate_type,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        #{id,jdbcType=INTEGER},
      </if>
      <if test="type != null" >
        #{type,jdbcType=VARCHAR},
      </if>
      <if test="operate_type != null" >
        #{operate_type,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>
  
  <delete id="deleteByParams" parameterType="java.util.Map">
  	delete from 1dcq_tempory_index_record
  	where 
  	 <if test="type != null" >
	  	type=#{type}
	  	and 
  	 </if>
  	id in
  	<foreach collection="list" item="item" open="(" separator="," close=")">
  	 	 #{item}
  	</foreach>
  </delete>
  
  <select id="queryNeedIndexShopCount" parameterType="java.util.Map" resultType="java.lang.Integer">
  	 select count(1) from 1dcq_shop WHERE LAST_UPDATE_TIME>=TIMESTAMP(#{lastUpdateTime})
  </select>
  <select id="queryNeedIndexShopForMarketCount" parameterType="java.util.Map" resultType="java.lang.Integer">
  	 select count(1) from 1dcq_shop_marketing WHERE LAST_UPDATE_TIME>=TIMESTAMP(#{lastUpdateTime})
  </select>
  <select id="queryNeedIndexGoodsCount" parameterType="java.util.Map" resultType="java.lang.Integer">
  	 select count(1) from 1dcq_goods WHERE LAST_UPDATE_TIME>=TIMESTAMP(#{lastUpdateTime}) and goods_group_id is null
  </select>
  
  <select id="getNeedIndexGoodsGroupCount" parameterType="java.util.Map" resultType="java.lang.Integer">
  	 select count(1) from 1dcq_goods_group WHERE LAST_UPDATE_TIME>=TIMESTAMP(#{lastUpdateTime}) 
  </select>
  
   <select id="getNeedIndexGoodsForGroupCount" parameterType="java.util.Map" resultType="java.lang.Integer">
  	 SELECT count(DISTINCT(goods_group_id)) from 1dcq_goods WHERE LAST_UPDATE_TIME>=TIMESTAMP(#{lastUpdateTime}) 
  </select>
  
   <!-- 查询前100000条中记录最大的goodsId值 -->
  <select id="queryMaxGoodsId" resultType="java.lang.Long">
  	select max(t.goods_id) from (select goods_id from 1dcq_goods_replication go order by go.goods_id  limit #{pageSize},1)t
  </select>
  
  <!-- 删除商品id小于某个值的所有商品记录 -->
  <delete id="deleteByMaxGoodsId">
  	<![CDATA[ delete from 1dcq_goods_replication  where goods_id<#{maxGoodsId}	 order by goods_id asc limit #{pageSize}]]>
  </delete>
  <!-- 将商品表数据复制进另外一张表 -->
  <select id="copyGoodsDataIntoTable">
  	insert into goods_tempory_index select * from 1dcq_goods_replication order by goods_id asc  limit #{pageSize}
  </select>
</mapper>