<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.idcq.idianmgr.dto.goodsGroup.GoodsGroupProValuesDto" >
  <resultMap id="BaseResultMap" type="com.idcq.idianmgr.dto.goodsGroup.GoodsGroupProValuesDto" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Jul 30 10:37:48 CST 2015.
    -->
    <id column="pro_values_id" property="proValuesId" jdbcType="INTEGER" />
    <result column="pro_value" property="proValue" jdbcType="VARCHAR" />
    <result column="group_property_id" property="groupPropertyId" jdbcType="INTEGER" />
    <result column="values_order" property="valuesOrder" jdbcType="SMALLINT" />
    <result column="is_select" property="isSelect" jdbcType="INTEGER" />
  </resultMap>
  <sql id="Base_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Jul 30 10:37:48 CST 2015.
    -->
    pro_values_id, pro_value, group_property_id, values_order,is_select
  </sql>
  <select id="getGoodsGroupProValuesList" resultMap="BaseResultMap" parameterType="java.util.Map" >
    select
    <include refid="Base_Column_List" />
    from 1dcq_goods_group_pro_values
    where 1=1
    <if test="groupPropertyId != null" >
      and group_property_id=#{groupPropertyId}
    </if>
  </select>

  <select id="getGoodsGroupProValues" resultMap="BaseResultMap" parameterType="java.util.Map" >
    select 
    <include refid="Base_Column_List" />
    from 1dcq_goods_group_pro_values
    where
    1=1
    <if test="proValuesId != null">
    	pro_values_id = #{proValuesId,jdbcType=INTEGER}
    </if> 
    <if test="groupPropertyId != null">
    	and group_property_id = #{groupPropertyId}
    </if>
    <if test="proValuesName != null">
    	and pro_value = #{proValuesName}
    </if>  
     limit 1
  </select>
  <delete id="delGoodsGroupProValue" parameterType="java.lang.Integer" >
    delete from 1dcq_goods_group_pro_values
    where pro_values_id = #{proValuesId,jdbcType=INTEGER}
  </delete>
  <!-- 根据商品族属性值编号集批量删除记录 -->
  <delete id="batchDelGoodsGroupProValuesDtoByIds" parameterType="java.util.List">
  	DELETE
	FROM
		1dcq_goods_group_pro_values
	WHERE
		pro_values_id IN (
			<foreach collection="list" item="proValuesId" separator="," close="" open="">
				#{proValuesId}
			</foreach>
		)
  </delete>
  <insert id="insertGoodsGroupProValue" parameterType="com.idcq.idianmgr.dto.goodsGroup.GoodsGroupProValuesDto" keyProperty="proValuesId" useGeneratedKeys="true">
    insert into 1dcq_goods_group_pro_values
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="proValue != null" >
        pro_value,
      </if>
      <if test="groupPropertyId != null" >
        group_property_id,
      </if>
      <if test="valuesOrder != null" >
        values_order,
      </if>
      <if test="isSelect != null" >
        is_select,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="proValue != null" >
        #{proValue,jdbcType=VARCHAR},
      </if>
      <if test="groupPropertyId != null" >
        #{groupPropertyId,jdbcType=INTEGER},
      </if>
      <if test="valuesOrder != null" >
        #{valuesOrder,jdbcType=SMALLINT},
      </if>
      <if test="isSelect != null" >
        is_select = #{isSelect,jdbcType=INTEGER},
      </if>
    </trim>
  </insert>
  <!-- 添加商品族属性值记录，返回主键 -->
  <insert id="addGoodsGroupProValueBackId" parameterType="com.idcq.idianmgr.dto.goodsGroup.GoodsGroupProValuesDto" >
  	<selectKey resultType="java.lang.Long" order="AFTER" keyProperty="proValuesId">
		SELECT LAST_INSERT_ID() AS proValuesId
	</selectKey>
	insert into 1dcq_goods_group_pro_values
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="proValue != null" >
        pro_value,
      </if>
      <if test="groupPropertyId != null" >
        group_property_id,
      </if>
      <if test="valuesOrder != null" >
        values_order,
      </if>
      <if test="isSelect != null" >
        is_select,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="proValue != null" >
        #{proValue,jdbcType=VARCHAR},
      </if>
      <if test="groupPropertyId != null" >
        #{groupPropertyId,jdbcType=INTEGER},
      </if>
      <if test="valuesOrder != null" >
        #{valuesOrder,jdbcType=SMALLINT},
      </if>
      <if test="isSelect != null" >
        #{isSelect,jdbcType=INTEGER},
      </if>
    </trim>
  </insert>
  <update id="updateGoodsGroupProValue" parameterType="com.idcq.idianmgr.dto.goodsGroup.GoodsGroupProValuesDto" >
    update 1dcq_goods_group_pro_values
    <set >
      <if test="proValue != null" >
        pro_value = #{proValue,jdbcType=VARCHAR},
      </if>
      <if test="groupPropertyId != null" >
        group_property_id = #{groupPropertyId,jdbcType=INTEGER},
      </if>
      <if test="valuesOrder != null" >
        values_order = #{valuesOrder,jdbcType=SMALLINT},
      </if>
      <if test="isSelect != null" >
        is_select = #{isSelect,jdbcType=INTEGER},
      </if>
    </set>
    where pro_values_id = #{proValuesId,jdbcType=INTEGER}
  </update>
  <!-- 将商品族属性值置为选中 -->
  <update id="updateIsSelectByIds" parameterType="java.util.List">
  	UPDATE 1dcq_goods_group_pro_values
	SET is_select = 1
	WHERE
		pro_values_id IN (
			<foreach collection="list" item="proValuesId" separator="," close="" open="">
				#{proValuesId}
			</foreach>
		)
  </update>
  
   <update id="updateIsNotSelectByIds" parameterType="java.util.List">
	  	UPDATE 1dcq_goods_group_pro_values
		SET is_select = 0
		WHERE
			pro_values_id IN (
				<foreach collection="list" item="proValuesId" separator="," close="" open="">
					#{proValuesId}
				</foreach>
			)
   </update>
  
  <!-- 将商品族属性值的is_select全部置为0 -->
  <update id="updateIsSelectEqZero" parameterType="java.lang.Long">
  	UPDATE 1dcq_goods_group_pro_values pv
	INNER JOIN 1dcq_goods_group_property gp ON pv.group_property_id = gp.group_property_id
	INNER JOIN 1dcq_goods_group gg ON gp.goods_group_id = gg.goods_group_id
	AND gg.goods_group_id = #{goodsGroupId}
	SET is_select = 0
  </update>
  <select id="getGoodsGroupProValuesByIdList" resultMap="BaseResultMap">
  		select * from 1dcq_goods_group_pro_values v where v.group_property_id
  		in
  		 <foreach collection="propertyIdList" item="item" open="(" separator="," close=")">
	     	#{item}
	     </foreach>
	     and v.is_select=1
  </select>
</mapper>